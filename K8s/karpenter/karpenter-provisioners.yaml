# apiVersion: karpenter.sh/v1alpha5
# kind: Provisioner
# metadata:
#   name: default
# spec:
#   
#   ttlSecondsAfterEmpty: 30

#   # Allowed instance requirements
#   requirements:
#     - key: "kubernetes.io/arch"
#       operator: In
#       values: ["amd64"]
#     - key: "karpenter.k8s.aws/instance-category"
#       operator: In
#       values: ["t"]  

#   # Maximum resources Karpenter can provision
#   limits:
#     resources:
#       cpu: 18
#       memory: 16

#   # Provider-specific settings for AWS
#   provider:
#     subnetSelector:
#       karpenter: ${CLUSTER_NAME}   # replace with your cluster name or tag
#     securityGroupSelector:
#       karpenter: ${CLUSTER_NAME}   # replace with your cluster name or tag

#   # Labels applied to provisioned nodes
#   labels:
#     karpenter.sh/provisioner-name: default


# --- EC2NodeClass ---
apiVersion: karpenter.k8s.aws/v1
kind: EC2NodeClass
metadata:
  name: default
spec:
  amiFamily: AL2
  role: ${CLUSTER_NAME}-karpenter                 
  subnetSelectorTerms:
    - tags:
        karpenter.sh/discovery: ${CLUSTER_NAME}
  securityGroupSelectorTerms:
    - tags:
        karpenter.sh/discovery: ${CLUSTER_NAME}
  amiSelectorTerms:
    - id: ami-05473caa821530341                    
  tags:
    Name: karpenter-node
    managed-by: karpenter

---

# --- NodePool ---
apiVersion: karpenter.sh/v1
kind: NodePool
metadata:
  name: default
spec:
  template:
    spec:
      nodeClassRef:
        group: karpenter.k8s.aws
        kind: EC2NodeClass
        name: default
      requirements:
        - key: "kubernetes.io/arch"
          operator: In
          values: ["amd64"]
        - key: "karpenter.k8s.aws/instance-category"
          operator: In
          values: ["t"]
  limits:
      cpu: "4"                                     
      memory: "6Gi"
  disruption:
    consolidateAfter: 30s



